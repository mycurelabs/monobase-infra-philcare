# FerretDB Chart - Default Values
# MongoDB-compatible database using PostgreSQL backend

# Global enable/disable toggle
enabled: true

# FerretDB configuration
image:
  repository: ghcr.io/ferretdb/ferretdb
  tag: "2.7.0"
  pullPolicy: IfNotPresent

# Number of FerretDB replicas
replicaCount: 1

# FerretDB resources
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# PostgreSQL with DocumentDB extension (backend for FerretDB)
postgresql:
  image:
    repository: ghcr.io/ferretdb/postgres-documentdb
    tag: "17-0.107.0-ferretdb-2.7.0"
    pullPolicy: IfNotPresent

  # PostgreSQL resources
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

  # Persistence
  persistence:
    enabled: true
    storageClass: ""
    size: 20Gi

# Service configuration
service:
  # FerretDB service (MongoDB-compatible port)
  port: 27017
  type: ClusterIP

# External Secrets configuration
# Creates ExternalSecret to sync credentials from cloud secret manager
externalSecrets:
  enabled: true
  secretStore: "gcp-secretstore"
  refreshInterval: "1h"
  passwordKey: ""  # Must be provided (e.g., philcare-staging-mongodb-root-password)

# Authentication
auth:
  username: "root"
  database: "ferretdb"
  existingSecret: "mongodb"

# Pod Security Context
podSecurityContext:
  enabled: true
  fsGroup: 999

# Container Security Context
containerSecurityContext:
  enabled: true
  runAsUser: 999
  runAsNonRoot: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  seccompProfile:
    type: RuntimeDefault

# NetworkPolicy
networkPolicy:
  enabled: true
  # Allow connections from HapiHub and Cadence pods
  allowedPods:
    - app.kubernetes.io/name: hapihub
    - app.kubernetes.io/name: cadence
